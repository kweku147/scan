"use strict";var V=Object.create;var l=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames,N=Object.getOwnPropertySymbols,W=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var k=(s,t,e)=>t in s?l(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,g=(s,t)=>{for(var e in t||(t={}))F.call(t,e)&&k(s,e,t[e]);if(N)for(var e of N(t))z.call(t,e)&&k(s,e,t[e]);return s};var B=(s,t)=>{for(var e in t)l(s,e,{get:t[e],enumerable:!0})},G=(s,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of C(t))!F.call(s,n)&&n!==e&&l(s,n,{get:()=>t[n],enumerable:!(r=q(t,n))||r.enumerable});return s};var $=(s,t,e)=>(e=s!=null?V(W(s)):{},G(t||!s||!s.__esModule?l(e,"default",{value:s,enumerable:!0}):e,s)),J=s=>G(l({},"__esModule",{value:!0}),s);var Q={};B(Q,{findGhost:()=>y,findPhantom:()=>y});module.exports=J(Q);var u=require("fs"),p=require("path"),x=$(require("gogocode")),j=$(require("validate-npm-package-name"));var a=[".css",".scss",".sass",".less"],f=[".js",".jsx",".ts",".tsx"],h=[".vue"];function y(s,t,e={}){var v,P;let r=[s].flat(),n=t&&(0,u.existsSync)(t)?JSON.parse((0,u.readFileSync)(t,"utf-8")):{},c=g(g({},n.dependencies),n.devDependencies),o=[],w=[...a,...f,...h];for(let i of r)!(0,u.existsSync)(i)||((0,u.statSync)(i).isDirectory()?o.push(...I(i,w)):o.push(i));o=[...new Set(o)];let S=[];for(let i of o){let L=M((0,u.readFileSync)(i,"utf-8"),(0,p.parse)(i).ext).filter(m=>T(i,m)).map(m=>H(m));S.push(...L)}let d=new Set(S);for(let i of Object.keys(c))d.has(i)&&d.delete(i);let A=(v=e.exclude)!=null?v:[],E=!((P=e.includeNodeLib)!=null&&P);return[...d].filter(i=>!O(i,A)).filter(i=>!E||!b(i)).filter(i=>E||!b(i)?K(i):!0)}function M(s,t){let e=[];return f.includes(t)&&e.push(...D(s)),a.includes(t)&&e.push(..._(s)),h.includes(t)&&e.push(...R(s)),e}function R(s){let t=[],r=(0,x.default)(s.replace(/<script(.*)setup(.*)>/,"<script$1$2>"),{parseOptions:{language:"vue"}}).find("<script><\/script>").generate().trim();return t.push(...D(r)),t.push(..._(s)),t}function _(s){var n;let t=[],e=/^@import\s+['"](.*)?['"]/,r=s.split(`
`);for(let c of r){let o=(n=c.trim().match(e))==null?void 0:n[1];o&&t.push(o)}return t}function D(s){let t=[],e=(0,x.default)(s);if(!e.find)return t;let r=n=>{let c=n.attr("source.value");t.push(c)};return e.find({type:"ImportDeclaration"}).each(r),e.find({type:"ExportNamedDeclaration"}).each(r),e.find("import($_$)").each(n=>{var o;let c=(o=n.match[0][0])==null?void 0:o.value;t.push(c)}),e.find("require($_$)").each(n=>{var o;let c=(o=n.match[0][0])==null?void 0:o.value;t.push(c)}),t}function I(s,t=[],e=["node_modules",".git",".vscode"]){let r=(0,u.readdirSync)(s,{withFileTypes:!0}),n=[];for(let c of r){let o=(0,p.join)(s,c.name);O(o,e)||(c.isFile()&&(t.length===0||t.includes((0,p.parse)(o).ext))&&n.push(o),c.isDirectory()&&n.push(...I(o,t,e)))}return n}function O(s,t){return[t].flat().filter(r=>r).findIndex(r=>typeof r=="string"?s.includes(r):r.test(s))!==-1}function T(s,t){let{dir:e}=(0,p.parse)(s);return t?t.includes("node_modules")?!0:!(["./","../","@/","~@/","`"].some(r=>t.startsWith(r))||["",...a,...f].some(r=>(0,u.existsSync)((0,p.join)(e,`${t}${r}`)))):!1}function H(s){let t=s.replace(/~/g,"").replace(/.*node_modules\//,"").split("/");return t[0].startsWith("@")?t.slice(0,2).join("/"):t[0]}function b(s){return/^(?:assert|buffer|child_process|cluster|console|constants|crypto|dgram|dns|domain|events|fs|http|https|module|net|os|path|punycode|querystring|readline|repl|stream|string_decoder|sys|timers|tls|tty|url|util|vm|zlib)$/.test(s)}function K(s){return(0,j.default)(s).validForNewPackages}0&&(module.exports={findGhost,findPhantom});
//# sourceMappingURL=index.js.map